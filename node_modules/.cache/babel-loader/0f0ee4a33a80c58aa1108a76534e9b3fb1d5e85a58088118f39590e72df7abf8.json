{"ast":null,"code":"import { combineLatest, map, of } from 'rxjs';\nimport { objectSpread } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nfunction isSeatHolder(value) {\n  return !Array.isArray(value);\n}\nfunction isCandidateTuple(value) {\n  return Array.isArray(value);\n}\nfunction getAccountTuple(value) {\n  return isSeatHolder(value) ? [value.who, value.stake] : value;\n}\nfunction getCandidate(value) {\n  return isCandidateTuple(value) ? value[0] : value;\n}\nfunction sortAccounts(_ref, _ref2) {\n  let [, balanceA] = _ref;\n  let [, balanceB] = _ref2;\n  return balanceB.cmp(balanceA);\n}\nfunction getConstants(api, elections) {\n  return elections ? {\n    candidacyBond: api.consts[elections].candidacyBond,\n    desiredRunnersUp: api.consts[elections].desiredRunnersUp,\n    desiredSeats: api.consts[elections].desiredMembers,\n    termDuration: api.consts[elections].termDuration,\n    votingBond: api.consts[elections].votingBond\n  } : {};\n}\nfunction getModules(api) {\n  const [council] = api.registry.getModuleInstances(api.runtimeVersion.specName, 'council') || ['council'];\n  const elections = api.query.phragmenElection ? 'phragmenElection' : api.query.electionsPhragmen ? 'electionsPhragmen' : api.query.elections ? 'elections' : null;\n  return [council, elections];\n}\nfunction queryAll(api, council, elections) {\n  return api.queryMulti([api.query[council].members, api.query[elections].candidates, api.query[elections].members, api.query[elections].runnersUp]);\n}\nfunction queryCouncil(api, council) {\n  return combineLatest([api.query[council].members(), of([]), of([]), of([])]);\n}\n/**\n * @name info\n * @returns An object containing the combined results of the storage queries for\n * all relevant election module properties.\n * @example\n * <BR>\n *\n * ```javascript\n * api.derive.elections.info(({ members, candidates }) => {\n *   console.log(`There are currently ${members.length} council members and ${candidates.length} prospective council candidates.`);\n * });\n * ```\n */\nexport function info(instanceId, api) {\n  return memo(instanceId, () => {\n    const [council, elections] = getModules(api);\n    return (elections ? queryAll(api, council, elections) : queryCouncil(api, council)).pipe(map(_ref3 => {\n      let [councilMembers, candidates, members, runnersUp] = _ref3;\n      return objectSpread({}, getConstants(api, elections), {\n        candidateCount: api.registry.createType('u32', candidates.length),\n        candidates: candidates.map(getCandidate),\n        members: members.length ? members.map(getAccountTuple).sort(sortAccounts) : councilMembers.map(a => [a, api.registry.createType('Balance')]),\n        runnersUp: runnersUp.map(getAccountTuple).sort(sortAccounts)\n      });\n    }));\n  });\n}","map":{"version":3,"names":["combineLatest","map","of","objectSpread","memo","isSeatHolder","value","Array","isArray","isCandidateTuple","getAccountTuple","who","stake","getCandidate","sortAccounts","_ref","_ref2","balanceA","balanceB","cmp","getConstants","api","elections","candidacyBond","consts","desiredRunnersUp","desiredSeats","desiredMembers","termDuration","votingBond","getModules","council","registry","getModuleInstances","runtimeVersion","specName","query","phragmenElection","electionsPhragmen","queryAll","queryMulti","members","candidates","runnersUp","queryCouncil","info","instanceId","pipe","_ref3","councilMembers","candidateCount","createType","length","sort","a"],"sources":["/home/driemworks/cryptex/ui/node_modules/@polkadot/api-derive/elections/info.js"],"sourcesContent":["import { combineLatest, map, of } from 'rxjs';\nimport { objectSpread } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nfunction isSeatHolder(value) {\n    return !Array.isArray(value);\n}\nfunction isCandidateTuple(value) {\n    return Array.isArray(value);\n}\nfunction getAccountTuple(value) {\n    return isSeatHolder(value)\n        ? [value.who, value.stake]\n        : value;\n}\nfunction getCandidate(value) {\n    return isCandidateTuple(value)\n        ? value[0]\n        : value;\n}\nfunction sortAccounts([, balanceA], [, balanceB]) {\n    return balanceB.cmp(balanceA);\n}\nfunction getConstants(api, elections) {\n    return elections\n        ? {\n            candidacyBond: api.consts[elections].candidacyBond,\n            desiredRunnersUp: api.consts[elections].desiredRunnersUp,\n            desiredSeats: api.consts[elections].desiredMembers,\n            termDuration: api.consts[elections].termDuration,\n            votingBond: api.consts[elections].votingBond\n        }\n        : {};\n}\nfunction getModules(api) {\n    const [council] = api.registry.getModuleInstances(api.runtimeVersion.specName, 'council') || ['council'];\n    const elections = api.query.phragmenElection\n        ? 'phragmenElection'\n        : api.query.electionsPhragmen\n            ? 'electionsPhragmen'\n            : api.query.elections\n                ? 'elections'\n                : null;\n    return [council, elections];\n}\nfunction queryAll(api, council, elections) {\n    return api.queryMulti([\n        api.query[council].members,\n        api.query[elections].candidates,\n        api.query[elections].members,\n        api.query[elections].runnersUp\n    ]);\n}\nfunction queryCouncil(api, council) {\n    return combineLatest([\n        api.query[council].members(),\n        of([]),\n        of([]),\n        of([])\n    ]);\n}\n/**\n * @name info\n * @returns An object containing the combined results of the storage queries for\n * all relevant election module properties.\n * @example\n * <BR>\n *\n * ```javascript\n * api.derive.elections.info(({ members, candidates }) => {\n *   console.log(`There are currently ${members.length} council members and ${candidates.length} prospective council candidates.`);\n * });\n * ```\n */\nexport function info(instanceId, api) {\n    return memo(instanceId, () => {\n        const [council, elections] = getModules(api);\n        return (elections\n            ? queryAll(api, council, elections)\n            : queryCouncil(api, council)).pipe(map(([councilMembers, candidates, members, runnersUp]) => objectSpread({}, getConstants(api, elections), {\n            candidateCount: api.registry.createType('u32', candidates.length),\n            candidates: candidates.map(getCandidate),\n            members: members.length\n                ? members.map(getAccountTuple).sort(sortAccounts)\n                : councilMembers.map((a) => [a, api.registry.createType('Balance')]),\n            runnersUp: runnersUp.map(getAccountTuple).sort(sortAccounts)\n        })));\n    });\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}